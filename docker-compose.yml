services:
  artech_cms:
    container_name: artech_cms
    user: root
    build: 
      context: ./artech-cms-api/
      dockerfile: ./src/main/docker/Dockerfile.jvm
      args:
        - DB_USERNAME=root
        - DB_PASSWORD=root
        - DB_URL=jdbc:mysql://mysql_artech:3306/artech
        - QUARKUS_HTTP_PORT=8081
    environment:
      - DB_USERNAME=root
      - DB_PASSWORD=root
      - DB_URL=jdbc:mysql://mysql_artech:3306/artech
      - QUARKUS_HTTP_PORT=8081
    networks:
      - database_connection
      - artech_network
    depends_on:
      - mysql_artech
    ports:
      - "8081:8081"
    #volumes:
      #- cms_storage:/deployments/storage/images/articles
      #- cms_storage:/deployments/storage/images/management
  artech_client:
    container_name: artech_client
    user: root
    build: 
      context: ./artech-client-api/
      dockerfile: ./src/main/docker/Dockerfile.jvm
      args:
        - DB_USERNAME=root
        - DB_PASSWORD=root
        - DB_URL=jdbc:mysql://mysql_artech:3306/artech
        - QUARKUS_HTTP_PORT=8082
    environment:
      - DB_USERNAME=root
      - DB_PASSWORD=root
      - DB_URL=jdbc:mysql://mysql_artech:3306/artech
      - QUARKUS_HTTP_PORT=8082
    ports:
      - "8082:8082"
    networks:
      - database_connection
      - artech_network
    depends_on:
      - mysql_artech
    volumes:
      - client_storage:/deployments/storage/images/users

  mysql_artech:
    container_name: mysql_artech
    #image: mysql
    build: 
      context: ./mysql/
      dockerfile: ./Dockerfile.mysql
    environment:
      # MYSQL_DATABASE: artech
      MYSQL_ROOT_PASSWORD: root
    ports:
      - "3306:3306"
    #volumes:
      # - mysql-volume:/var/lib/mysql
      #- ./mysql/schema.sql:/docker-entrypoint-initdb.d/schema.sql
    networks:
      - database_connection
  
  ngix_gateway:
    container_name: ngix_gateway
    build: 
      context: ./ngix/
      dockerfile: ./Dockerfile
    networks:
      - artech_network
    depends_on:
      - artech_client
      - artech_cms
    ports:
      - "80:80"

volumes: 
  client_storage: {}
  #cms_storage: {}

networks:
  database_connection:
    driver: bridge
  artech_network:
    driver: bridge